<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ultra - API cnx/Dnx Wallet extension</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Unbounded Font from Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Unbounded', sans-serif;
    }

    .uniq-card {
      box-shadow: 0 1px 1px 0 #7A52D1, 0 10px 20px 0 #7A52D1;
      background-color: #000 !important;
    }

    .tag {
      position: absolute;
      left: 0;
      top: 18px;
      z-index: 1000;
      background-color: #FFF;
      padding: 2px 6px 2px 8px;
      font-size: 9pt;
      color: #7A52D1;
      font-weight: bold;
    }

    .card-title {
      font-size: 11pt;
      text-transform: uppercase;
      font-weight: bold;
      color: #EEE;
    }

    .card-subtitle {
      font-size: 8pt;
      text-transform: uppercase;
      color: #CCC !important;
    }

    .uniq-subblock {
      padding-top: 20px;
      padding-bottom: 20px;
    }

    .price-euro {
      font-size: 9pt;
      color: #EEE;
    }

    .price-uos {
      font-size: 11pt;
      font-weight: bold;
      color: #7A52D1 !important;
    }

    /* ‚úÖ Professional Toast style */
    .custom-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      min-width: 320px;
      max-width: 400px;
      gap: 12px;
      animation: slideIn 0.4s ease forwards;
    }

    .toast-icon {
      font-size: 24px;
      line-height: 1;
    }

    .toast-message {
      flex: 1;
      font-size: 15px;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body class="bg-gray-900 text-white">

<!-- ‚úÖ Toast: Ultra Wallet not installed -->
<div id="noExtToast" class="custom-toast bg-danger text-white">
  <div class="toast-icon">‚ö†Ô∏è</div>
  <div class="toast-message">
    <strong>Ultra Wallet</strong> extension not found!<br>
    Please install it from:
    <a href="https://ultra.io/download" class="text-white text-decoration-underline" target="_blank">Ultra.io</a>
  </div>
  <button class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
</div>

<!-- ‚úÖ Toast: Login required -->
<div id="liveToast" class="custom-toast bg-warning text-dark">
  <div class="toast-icon">‚ÑπÔ∏è</div>
  <div class="toast-message">
    Please login to your <strong>Ultra</strong> Wallet to continue.
  </div>
  <button class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
</div>

<main class="max-w-4xl mx-auto px-4 py-10">
  <h1 class="text-2xl font-bold text-purple-400 mb-6">
    Ultra - API cnx/Dnx Wallet extension
  </h1>

  <p class="mb-4 leading-relaxed text-gray-300">
    If your Wallet extension is installed, click the 3 buttons to verify in the console whether the system detects your Wallet connection status!
  </p>

  <hr class="my-6 border-purple-700">

  <div class="flex flex-wrap gap-4">
    <button onclick="loginWallet()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded transition duration-300">
      Wallet connexion
    </button>

    <button onclick="checkWallet()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded transition duration-300">
      Check Wallet state
    </button>

    <button onclick="logoutWallet()" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded transition duration-300">
      Disconnect Wallet
    </button>
  </div>
</main>

<script>
// Check if the page is fully loaded
if (document.readyState !== 'complete') {
  window.addEventListener('load', afterWindowLoaded);
} else {
  afterWindowLoaded();
}

// Function to run after page load
function afterWindowLoaded() {
  // Check if Ultra Wallet is available
  if ('ultra' in window) {
    console.log('‚úÖ Ultra Wallet is available!');
  } else {
    console.log('‚ùå Ultra Wallet not detected!');

    const noExtToast = document.getElementById('noExtToast');
    if (noExtToast) {
      const toastNoExt = bootstrap.Toast.getOrCreateInstance(noExtToast);
      toastNoExt.show();
    }

    return;
  }

  // Check if there's a trusted session
  const eagerlyConnection = localStorage.getItem('eagerlyConnection');

  if (!eagerlyConnection || eagerlyConnection !== 'true') {
    console.log("‚ö†Ô∏è No trusted session found in localStorage!");

    const walletToast = document.getElementById('liveToast');
    if (walletToast) {
      const toastBootstrap = bootstrap.Toast.getOrCreateInstance(walletToast);
      toastBootstrap.show();
    }
  } else {
    console.log("üîê Trusted session found!");
  }
}

// Function to login to Ultra Wallet
async function loginWallet() {
  try {
    const response = await ultra.connect({ referralCode: 'ecd1f052-9d0d-4b84-8dd3-10a753d044b5' });

    const walletId = response.data.blockchainid;
    const pubKey = response.data.publicKey;

    console.log("‚úÖ Connected to wallet: " + walletId);
    console.log("üîë Public Key: " + pubKey);

    localStorage.setItem('eagerlyConnection', 'true');

  } catch (err) {
    console.log("‚ùå Failed to connect to wallet:");
    console.log(err);
  }
}

// Optional function to check wallet state
async function checkWallet() {
  console.log('üïµÔ∏è‚Äç‚ôÇÔ∏è Checking wallet state...');

  try {
    const response = await ultra.connect({ onlyIfTrusted: true });

    const walletId = response.data.blockchainid;
    const pubKey = response.data.publicKey;
    console.log(response.data);
    console.log("‚úÖ Trusted connection verified:");
    console.log("üîó Wallet ID: " + walletId);
    console.log("üîë Public Key: " + pubKey);

    localStorage.setItem('eagerlyConnection', 'true');

  } catch (err) {
    console.log("‚ùå Failed to verify trusted connection!");
    console.log(err);
    localStorage.removeItem('eagerlyConnection');
  }
}

// Function to logout from wallet
async function logoutWallet() {
  console.log("üëã Logging out from wallet...");

  try {
    const result = await ultra.disconnect();
    localStorage.removeItem('eagerlyConnection');
    console.log("‚úÖ Disconnected from wallet successfully!");
    console.log(result);
  } catch (error) {
    console.log("‚ÑπÔ∏è Logout canceled by user.");
    return;
  }
}

// Function to show toast
function showToast(id) {
  const toastEl = document.getElementById(id);
  if (toastEl) {
    toastEl.classList.add('show');
    setTimeout(() => {
      toastEl.classList.remove('show');
    }, 5000); // Hide after 5 seconds
  }
}
</script>

</body>
</html>
